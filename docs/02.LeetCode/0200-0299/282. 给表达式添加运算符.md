---
id: B7E2E30732DB291A
title: 282、给表达式添加运算符
date: 2022-01-09 21:58:01
permalink: /leetcode/expression-add-operators
link: https://leetcode-cn.com/problems/expression-add-operators
toc: false
categories:
  - LeetCode
tags:
  - 数学
  - 字符串
  - 回溯
---

<Level type="hard"/>

## 题目

给定一个仅包含数字 `0-9` 的字符串 `num` 和一个目标值整数 `target` ，在 `num` 的数字之间添加 **二元** 运算符（不是一元）`+`、`-`或`*`，返回**所有**能够得到 `target` 的表达式。

注意，返回表达式中的操作数 **不应该** 包含前导零。

## 示例

示例 1:

```text
输入: num = "123", target = 6
输出: ["1+2+3", "1*2*3"]
解释: “1*2*3” 和 “1+2+3” 的值都是6。
```

示例 2:

```text
输入: num = "232", target = 8
输出: ["2*3+2", "2+3*2"]
解释: “2*3+2” 和 “2+3*2” 的值都是8。
```

示例 3:

```text
输入: num = "3456237490", target = 9191
输出: []
解释: 表达式 “3456237490” 无法得到 9191 。
```

## 提示

- 1 <= num.length <= 10
- num 仅含数字
- -2<sup>31</sup> <= target <= 2<sup>31</sup> - 1

## 分析

回溯搜索所有表达进行结合，详见[【宫水三叶】一道利用「代数系统」的回溯题](https://leetcode-cn.com/problems/expression-add-operators/solution/gong-shui-san-xie-hui-su-suan-fa-yun-yon-nl9z/)

## 解答

```javascript
/**
 * @param {string} num
 * @param {number} target
 * @return {string[]}
 */
var addOperators = function (num, target) {
  const n = num.length
  const ans = []
  /**
   * @param idx  第几个数字
   * @param prev 上一个数字
   * @param curr 当前表达式结果
   * @param exp  当前表达式
   */
  const dfs = (idx, prev, result, exp) => {
    if (idx === n) {
      if (result === target) {
        ans.push(exp)
      }
      return
    }
    for (let i = idx; i < n; i++) {
      // 前导0
      if (num[idx] === '0' && i !== idx) break
      // 当前的数字
      const curr = Number(num.substring(idx, i + 1))
      if (idx === 0) {
        dfs(i + 1, curr, curr, curr.toString())
      } else {
        // 加
        dfs(i + 1, curr, result + curr, `${exp}+${curr}`)
        // 减
        dfs(i + 1, -curr, result - curr, `${exp}-${curr}`)
        // 乘，乘法有优先级，需要先与上一个数字相乘，作为当前的数值，相乘后，result值需要先减上一个数字，再与相乘结果相加
        const x = prev * curr
        dfs(i + 1, x, result - prev + x, `${exp}*${curr}`)
      }
    }
  }
  dfs(0, 0, 0, '')
  return ans
}
```
